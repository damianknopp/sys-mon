// Generated by CoffeeScript 1.6.1
(function() {

  window.WebsocketHelper = (function() {

    function WebsocketHelper(location, onopen, onmessge, onclose) {
      this.location = location != null ? location : "ws://localhost:8080/sys-mon/echo";
      this.onopen = onopen;
      this.onmessge = onmessge;
      this.onclose = onclose;
      this.ws = void 0;
    }

    WebsocketHelper.prototype.connect = function(location) {
      var target,
        _this = this;
      this.location = location;
      target = this.location;
      this.ws = new WebSocket(target);
      console.log(this.ws);
      if (!this.onmessage) {
        this.ws.onmessage = function(event) {
          var json;
          console.log("" + event.data);
          json = JSON.parse(event.data);
          return console.log(json);
        };
      } else {
        this.ws.onmessage = this.onmessage;
      }
      if (!this.onopen) {
        this.ws.onopen = function() {
          var msg;
          console.log("opened connection");
          msg = {
            msg: "hello"
          };
          return _this.send(msg);
        };
      } else {
        this.ws.onopen = this.onopen;
      }
      if (!this.onclose) {
        this.ws.onclose = function() {
          return console.log("closed connection");
        };
      } else {
        this.ws.onclose = this.onclose;
      }
      return this.ws;
    };

    WebsocketHelper.prototype.send = function(obj) {
      var tmp;
      if (this.ws == null) {
        console.log("websocket is not initialized...");
        this.ws = this.connect(this.location);
        return console.log(this.ws);
      } else {
        console.log("reusing websocket connection");
        tmp = JSON.stringify(obj);
        return this.ws.send(tmp);
      }
    };

    WebsocketHelper.prototype.close = function() {
      if (this.ws != null) {
        return this.ws.close() && (this.ws = void 0);
      }
    };

    return WebsocketHelper;

  })();

}).call(this);
